## æµè¡Œçš„ SQL åº“å’Œ ORM é€‰é¡¹ (Popular SQL Libraries and ORM Options)

AdonisJS åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ Node.js ç”Ÿæ€ç³»ç»Ÿä¸­ä»»ä½•æµè¡Œçš„ SQL åº“å’Œ ORMã€‚

  * **Lucid**: ğŸ¥‡ è¿™æ˜¯ä¸€ä¸ªç”± AdonisJS æ ¸å¿ƒå›¢é˜Ÿåˆ›å»ºå’Œç»´æŠ¤çš„ **Active Record ORM** å’Œ SQL æŸ¥è¯¢æ„å»ºå™¨ï¼Œå®ƒæ„å»ºåœ¨ **Knex** ä¹‹ä¸Šã€‚
  * **Prisma**: ğŸš€ Node.js ç”Ÿæ€ç³»ç»Ÿä¸­å¦ä¸€ä¸ªæµè¡Œçš„ ORMï¼Œä»¥å…¶ç›´è§‚çš„**æ•°æ®æ¨¡å‹**ã€**è‡ªåŠ¨åŒ–è¿ç§»**ã€**ç±»å‹å®‰å…¨**å’Œ**è‡ªåŠ¨è¡¥å…¨**è€Œé—»åã€‚
  * **Kysely**: âœï¸ ä¸€ä¸ª**ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨**çš„ SQL **æŸ¥è¯¢æ„å»ºå™¨**ã€‚å¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªç²¾ç®€ä¸”ä¸å¸¦æ¨¡å‹çš„æŸ¥è¯¢æ„å»ºå™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚
  * **Drizzle ORM**: ğŸ’§ ç¤¾åŒºä¸­è®¸å¤š AdonisJS å¼€å‘è€…ä½¿ç”¨çš„ ORMï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå€¼å¾—æ¢ç´¢çš„æ›¿ä»£æ–¹æ¡ˆã€‚
  * **Mikro ORM**: ğŸ› ï¸ Node.js ç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªæ´»è·ƒç»´æŠ¤çš„ ORMï¼Œä¹Ÿæ„å»ºåœ¨ **Knex** ä¹‹ä¸Šï¼Œè™½ç„¶å®ƒæ¯” Lucid ç¨å¾®å†—é•¿ä¸€äº›ã€‚
  * **TypeORM**: ğŸ’» TypeScript ç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªæµè¡Œçš„ ORMã€‚

-----

## ä½¿ç”¨å…¶ä»– SQL åº“å’Œ ORM (Using Other SQL Libraries and ORMs)

å½“æ‚¨å†³å®šä¸ä½¿ç”¨ Lucid è€Œä½¿ç”¨å…¶ä»– ORM æˆ– SQL åº“æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦**æ‰‹åŠ¨æ›´æ”¹æŸäº›åŒ…çš„é…ç½®**ï¼Œä¾‹å¦‚**èº«ä»½éªŒè¯æ¨¡å—**ã€‚

### èº«ä»½éªŒè¯æ¨¡å—çš„é›†æˆ (Authentication Integration)

AdonisJS **èº«ä»½éªŒè¯æ¨¡å—**é»˜è®¤å†…ç½®äº†å¯¹ **Lucid** çš„æ”¯æŒæ¥è·å–ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚

å½“ä½¿ç”¨å¦ä¸€ä¸ª SQL åº“æˆ– ORM æ—¶ï¼Œæ‚¨å¿…é¡»å®ç°ä»¥ä¸‹æ¥å£ä¹‹ä¸€æ¥å®šä¹‰å¦‚ä½•ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·ï¼š

  * **`SessionUserProviderContract`**: ç”¨äº **Session å«å…µ (Session Guard)** çš„æä¾›ç¨‹åºã€‚
  * **`AccessTokensProviderContract`**: ç”¨äº **API ä»¤ç‰Œå«å…µ (Access Tokens Guard)** çš„æä¾›ç¨‹åºã€‚

#### ğŸ’¡ å®ç° `SessionUserProviderContract` ç¤ºä¾‹ (Example: Implementing `SessionUserProviderContract`)

ä»¥ä¸‹æ˜¯ä½¿ç”¨ **Kysely** æ—¶å®ç° `SessionUserProviderContract` æ¥å£çš„ç¤ºä¾‹ã€‚è¿™ä¸ªè‡ªå®šä¹‰æä¾›ç¨‹åºéœ€è¦å®ç°ä¸¤ä¸ªå…³é”®æ–¹æ³•ï¼š

1.  **`createUserForGuard(user)`**: å°†æ‚¨çš„ ORM/åº“è¿”å›çš„**åŸå§‹ç”¨æˆ·å¯¹è±¡**è½¬æ¢ä¸º**å«å…µå¯ç”¨çš„ç”¨æˆ·å¯¹è±¡**ã€‚
2.  **`findById(identifier)`**: ä½¿ç”¨æ‚¨çš„è‡ªå®šä¹‰åº“æ ¹æ®ç”¨æˆ· ID ä»æ•°æ®åº“ä¸­**æŸ¥æ‰¾ç”¨æˆ·**ã€‚

<!-- end list -->

```ts
import { symbols } from '@adonisjs/auth'
import type { SessionGuardUser, SessionUserProviderContract } from '@adonisjs/auth/types/session'
import type { Users } from '../../types/db.js' // Kysely ç‰¹å®šçš„ç”¨æˆ·ç±»å‹

export class SessionKyselyUserProvider implements SessionUserProviderContract<Users> {
Â  // ç”¨äºäº‹ä»¶è§¦å‘å™¨ï¼ˆEvent emitterï¼‰æ·»åŠ ç±»å‹ä¿¡æ¯
Â  declare [symbols.PROVIDER_REAL_USER]: Users

Â  // 1. åˆ›å»ºå«å…µæ‰€éœ€çš„ç”¨æˆ·å¯¹è±¡
Â  async createUserForGuard(user: Users): Promise<SessionGuardUser<Users>> {
Â  Â  return {
Â  Â  Â  getId() {
Â  Â  Â  Â  return user.id
Â  Â  Â  },
Â  Â  Â  getOriginal() {
Â  Â  Â  Â  return user
Â  Â  Â  },
Â  Â  }
Â  }

Â  // 2. ä½¿ç”¨ Kysely æŸ¥æ‰¾ç”¨æˆ·
Â  async findById(identifier: number): Promise<SessionGuardUser<Users> | null> {
Â  Â  const user = await db // å‡è®¾ db æ˜¯ Kysely å®ä¾‹
Â  Â  Â  .selectFrom('users')
Â  Â  Â  .selectAll()
Â  Â  Â  .where('id', '=', identifier)
Â  Â  Â  .executeTakeFirst()

Â  Â  if (!user) {
Â  Â  Â  return null
Â  Â  }

Â  Â  return this.createUserForGuard(user)
Â  }
}
```

#### æ³¨å†Œè‡ªå®šä¹‰ç”¨æˆ·æä¾›ç¨‹åº (Registering the Custom User Provider)

å®ç° `UserProvider` æ¥å£åï¼Œæ‚¨å¯ä»¥åœ¨èº«ä»½éªŒè¯é…ç½®ä¸­æ³¨å†Œå®ƒï¼Œ**æ›¿æ¢**é»˜è®¤çš„ Lucid æä¾›ç¨‹åºã€‚

```ts
const authConfig = defineConfig({
Â  default: 'web',

Â  guards: {
Â  Â  web: sessionGuard({
Â  Â  Â  useRememberMeTokens: false,
      // **æ³¨é‡Šæˆ–åˆ é™¤**åŸæœ‰çš„ Lucid æä¾›ç¨‹åºé…ç½®
Â  Â  Â  // provider: sessionUserProvider({ model: () => import('#models/user') }),
Â  Â  Â Â 
      // ä½¿ç”¨ configProvider æ³¨å†Œæ‚¨çš„è‡ªå®šä¹‰ Kysely æä¾›ç¨‹åº
Â  Â  Â  provider: configProvider.create(async () => { 
Â  Â  Â  Â  const { SessionKyselyUserProvider } = await import(
Â  Â  Â  Â  Â  '../app/auth/session_user_provider.js' // æ‚¨çš„è‡ªå®šä¹‰æ–‡ä»¶è·¯å¾„
Â  Â  Â  Â  )

Â  Â  Â  Â  return new SessionKyselyUserProvider()
Â  Â  Â  }),
Â  Â  }),
Â  },
})
```