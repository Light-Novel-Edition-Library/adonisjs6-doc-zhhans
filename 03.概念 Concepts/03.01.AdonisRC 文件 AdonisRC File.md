# AdonisRC 文件 (`adonisrc.ts`)

`adonisrc.ts` 文件用于配置应用程序的**工作区设置 (workspace settings)**。在此文件中，您可以[注册服务提供者 (providers)](https://www.google.com/search?q=%23providers)，定义[命令别名 (command aliases)](https://www.google.com/search?q=%23commandsaliases)，指定[要复制的文件 (metafiles)](https://www.google.com/search?q=%23metafiles)到生产构建中，以及执行更多操作。

:::warning

`adonisrc.ts` 文件会被**非 AdonisJS 应用程序**的其他工具导入。因此，您不得在此文件中编写任何特定于应用程序的代码或特定于环境的条件逻辑。

:::

该文件包含运行应用程序所需的最低配置。但是，您可以通过运行 `node ace inspect:rcfile` 命令来查看完整的文件内容。

```sh
node ace inspect:rcfile
```

您可以使用 `app` 服务访问已解析的 RCFile 内容。

```ts
import app from '@adonisjs/core/services/app'

console.log(app.rcFile)
```

-----

## typescript

`typescript` 属性告知框架和 Ace 命令您的应用程序使用 TypeScript。目前，此值始终设置为 `true`。但是，我们稍后将允许应用程序使用 JavaScript 编写。

-----

## directories (目录)

这是一组由\*\*脚手架命令 (scaffolding commands)\*\*使用的目录及其路径。如果您决定重命名特定的目录，请在 `directories` 对象内更新它们的新路径，以通知脚手架命令。

```ts
{
  directories: {
    config: 'config',
    commands: 'commands',
    contracts: 'contracts',
    public: 'public',
    providers: 'providers',
    languageFiles: 'resources/lang',
    migrations: 'database/migrations',
    seeders: 'database/seeders',
    factories: 'database/factories',
    views: 'resources/views',
    start: 'start',
    tmp: 'tmp',
    tests: 'tests',
    httpControllers: 'app/controllers',
    models: 'app/models',
    services: 'app/services',
    exceptions: 'app/exceptions',
    mails: 'app/mails',
    middleware: 'app/middleware',
    policies: 'app/policies',
    validators: 'app/validators',
    events: 'app/events',
    listeners: 'app/listeners',
    stubs: 'stubs',
  }
}
```

-----

## preloads (预加载文件)

一个文件数组，用于在应用程序\*\*引导时 (booting)\*\*导入。这些文件在服务提供者引导之后立即导入。

您可以定义导入文件的**环境 (environment)**。有效的选项有：

  * `web` 环境指为 **HTTP 服务器**启动的进程。
  * `console` 环境指除 `repl` 命令以外的 **Ace 命令**。
  * `repl` 环境指使用 `node ace repl` 命令启动的进程。
  * 最后，`test` 环境指为**运行测试**启动的进程。

:::note

您可以使用 `node ace make:preload` 命令创建和注册一个预加载文件。

:::

```ts
{
  preloads: [
    () => import('./start/view.js')
  ]
}
```

```ts
{
  preloads: [
    {
      file: () => import('./start/view.js'),
      environment: [
        'web',
        'console',
        'test'
      ]
    },
  ]
}
```

-----

## metaFiles (元文件)

`metaFiles` 数组是您在创建生产构建时希望**复制到 `build` 文件夹**中的文件集合。

这些是非 TypeScript/JavaScript 文件，但必须存在于生产构建中才能使您的应用程序正常工作。例如，Edge 模板、i18n 语言文件等。

  * `pattern`：用于查找匹配文件的 [glob 模式](https://github.com/sindresorhus/globby#globbing-patterns)。
  * `reloadServer`：当匹配文件更改时，**重新加载开发服务器**。

<!-- end list -->

```ts
{
  metaFiles: [
    {
      pattern: 'public/**',
      reloadServer: false
    },
    {
      pattern: 'resources/views/**/*.edge',
      reloadServer: false
    }
  ]
}
```

-----

## commands (命令)

一个函数数组，用于**延迟导入 (lazy import)** 来自已安装软件包的 Ace 命令。您的应用程序命令将自动导入，因此您无需显式注册它们。

另请参阅：[创建 Ace 命令](https://www.google.com/search?q=../ace/creating_commands.md)

```ts
{
  commands: [
    () => import('@adonisjs/core/commands'),
    () => import('@adonisjs/lucid/commands')
  ]
}
```

-----

## commandsAliases (命令别名)

命令别名的键值对。这通常用于帮助您为那些难以输入或记住的命令创建**便于记忆的别名**。

另请参阅：[创建命令别名](https://www.google.com/search?q=../ace/introduction.md%23creating-command-aliases)

```ts
{
  commandsAliases: {
    migrate: 'migration:run'
  }
}
```

您还可以为同一个命令定义多个别名。

```ts
{
  commandsAliases: {
    migrate: 'migration:run',
    up: 'migration:run'
  }
}
```

-----

## tests (测试)

`tests` 对象注册\*\*测试套件 (test suites)\*\*以及测试运行器的一些全局设置。

另请参阅：[测试简介](https://www.google.com/search?q=../testing/introduction.md)

```ts
{
  tests: {
    timeout: 2000,
    forceExit: false,
    suites: [
      {
        name: 'functional',
        files: [
          'tests/functional/**/*.spec.ts'
        ],
        timeout: 30000
      }
    ]
  }
}
```

  * `timeout`：定义所有测试的默认超时时间。
  * `forceExit`：在测试完成后立即**强制退出**应用程序进程。通常，执行优雅退出是一种良好的实践。
  * `suite.name`：测试套件的唯一名称。
  * `suite.files`：导入测试文件的 glob 模式数组。
  * `suite.timeout`：套件内所有测试的默认超时时间。

-----

## providers (服务提供者)

一个服务提供者数组，用于在应用程序**引导阶段**加载。

默认情况下，提供者在所有环境中加载。但是，您也可以定义一个明确的环境数组来导入提供者。

  * `web` 环境指为 **HTTP 服务器**启动的进程。
  * `console` 环境指除 `repl` 命令以外的 **Ace 命令**。
  * `repl` 环境指使用 `node ace repl` 命令启动的进程。
  * 最后，`test` 环境指为**运行测试**启动的进程。

:::note
提供者按照在 `providers` 数组中注册的**相同顺序**加载。
:::

另请参阅：[服务提供者](https://www.google.com/search?q=./service_providers.md)

```ts
{
  providers: [
    () => import('@adonisjs/core/providers/app_provider'),
    () => import('@adonisjs/core/providers/http_provider'),
    () => import('@adonisjs/core/providers/hash_provider'),
    () => import('./providers/app_provider.js'),
  ]
}
```

```ts
{
  providers: [
    {
      file: () => import('./providers/app_provider.js'),
      environment: [
        'web',
        'console',
        'test'
      ]
    },
    {
      file: () => import('@adonisjs/core/providers/http_provider'),
      environment: [
        'web'
      ]
    },
    () => import('@adonisjs/core/providers/hash_provider'),
    () => import('@adonisjs/core/providers/app_provider')
  ]
}
```

-----

## assetsBundler (资产打包器)

`serve` 和 `build` 命令会尝试检测您的应用程序使用的资产，以编译前端资产。

检测是通过搜索 `vite.config.js` 文件来针对 [vite](https://vitejs.dev) 执行的，以及通过搜索 `webpack.config.js` 文件来针对 [Webpack encore](https://github.com/symfony/webpack-encore) 执行的。

但是，如果您使用不同的资产打包器，则可以按如下方式在 `adonisrc.ts` 文件中进行配置。

```ts
{
  assetsBundler: {
    name: 'vite',
    devServer: {
      command: 'vite',
      args: []
    },
    build: {
      command: 'vite',
      args: ["build"]
    },
  }
}
```

  * `name`：您使用的资产打包器的名称。它是出于显示目的所必需的。
  * `devServer.*`：用于启动开发服务器的命令及其参数。
  * `build.*`：用于创建生产构建的命令及其参数。