# 安装 (Installation)

在创建新应用之前，您应该确保您的计算机上已安装 Node.js 和 npm。**AdonisJS 需要 Node.js 版本 20 或更高。**

您可以使用[官方安装程序](https://nodejs.org/en/download/)或 [Volta](https://docs.volta.sh/guide/getting-started) 来安装 Node.js。Volta 是一个跨平台的包管理器，可以在您的计算机上安装和运行多个 Node.js 版本。

```sh
// title: 验证 Node.js 版本
node -v
# v22.0.0
```

:::tip
**您更偏向视觉学习吗？** - 请查看我们 Adocasts 朋友提供的 [Let's Learn AdonisJS 6](https://adocasts.com/series/lets-learn-adonisjs-6) 免费**播客**系列。
:::

## 创建一个新应用 (Creating a new application)

您可以使用 [npm init](https://docs.npmjs.com/cli/v7/commands/npm-init) 来创建一个新项目。这些命令将下载 [`create-adonisjs`](https://www.google.com/search?q=%5Bhttp://npmjs.com/create-adonisjs%5D\(http://npmjs.com/create-adonisjs\)) 初始化程序包并开始安装过程。

您可以使用以下命令行标志 (CLI flags) 之一来自定义初始项目输出。

  * `--kit`：为项目选择[起始套件](https://www.google.com/search?q=%23starter-kits)。您可以选择 **web**、**api**、**slim** 或 **inertia**。
  * `--db`：指定您选择的数据库方言。您可以选择 **sqlite**、**postgres**、**mysql** 或 **mssql**。
  * `--git-init`：初始化 Git 仓库。默认为 `false`。
  * `--auth-guard`：指定您选择的身份验证守卫 (authentication guard)。您可以选择 **session** (会话)、**access\_tokens** (访问令牌) 或 **basic\_auth** (基本认证)。

:::codegroup

```sh
// title: npm
npm init adonisjs@latest hello-world
```

:::

当使用 `npm init` 命令传递 CLI 标志时，请确保使用[两次双破折号](https://stackoverflow.com/questions/43046885/what-does-do-when-running-an-npm-command)。否则，`npm init` 不会将标志传递给 `create-adonisjs` 初始化程序包。例如：

```sh
# 创建一个项目并提示所有选项
npm init adonisjs@latest hello-world

# 创建一个使用 MySQL 的项目
npm init adonisjs@latest hello-world -- --db=mysql

# 创建一个使用 PostgreSQL 和 API 起始套件的项目
npm init adonisjs@latest hello-world -- --db=postgres --kit=api

# 创建一个使用 API 起始套件和访问令牌守卫的项目
npm init adonisjs@latest hello-world -- --kit=api --auth-guard=access_tokens
```

## 起始套件 (Starter kits)

起始套件可作为使用 AdonisJS 创建应用程序的起点。它们带有一个[规范的文件夹结构](https://www.google.com/search?q=./folder_structure.md)、预配置的 AdonisJS 软件包以及您在开发过程中所需的必要工具。

:::note

官方起始套件使用 ES 模块和 TypeScript。这种组合允许您使用现代 JavaScript 构造并利用静态类型安全。

:::

### Web 起始套件 (Web starter kit)

Web 起始套件专为创建传统的服务器渲染 Web 应用程序而定制。不要让\*\*“传统”\*\*这个关键词让您气馁。如果您要制作一个前端交互性有限的 Web 应用程序，我们推荐使用此起始套件。

使用 [Edge.js](https://edgejs.dev) 在服务器上渲染 HTML 的简单性将提高您的生产力，因为您无需处理复杂的构建系统来渲染一些 HTML。

稍后，您可以使用 [Hotwire](https://hotwired.dev)、[HTMX](http://htmx.org) 或 [Unpoly](http://unpoly.com) 使您的应用程序像 SPA (单页应用) 一样导航，并使用 [Alpine.js](http://alpinejs.dev) 来创建像下拉菜单或模态框这样的交互式组件。

```sh
npm init adonisjs@latest -- -K=web

# 切换数据库方言
npm init adonisjs@latest -- -K=web --db=mysql
```

Web 起始套件附带以下软件包。

| Package | 描述 |
| :--- | :--- |
| `@adonisjs/core` | 框架的核心，具有您在创建后端应用程序时可能需要的基本功能。 |
| `edge.js` | 用于组合 HTML 页面的 [edge](https://edgejs.dev) 模板引擎。 |
| `@vinejs/vine` | [VineJS](https://vinejs.dev) 是 Node.js 生态系统中速度最快的验证库之一。 |
| `@adonisjs/lucid` | Lucid 是由 AdonisJS 核心团队维护的 SQL ORM。 |
| `@adonisjs/auth` | 框架的身份验证层。它被配置为使用会话 (sessions)。 |
| `@adonisjs/shield` | 一组安全原语，用于保护您的 Web 应用程序免受 **CSRF** 和 **XSS** 等攻击。 |
| `@adonisjs/static` | 用于从应用程序的 `/public` 目录提供静态资源的中间件。 |
| `vite` | [Vite](https://vitejs.dev/) 用于编译前端资产。 |

-----

### API 起始套件 (API starter kit)

API 起始套件专为创建 JSON API 服务器而定制。它是 `web` 起始套件的一个精简版。如果您计划使用 React 或 Vue 构建前端应用，您可以使用 API 起始套件创建您的 AdonisJS 后端。

```sh
npm init adonisjs@latest -- -K=api

# 切换数据库方言
npm init adonisjs@latest -- -K=api --db=mysql
```

在此起始套件中：

  * 我们移除了对提供静态文件的支持。
  * 不配置视图层和 Vite。
  * 关闭 XSS 和 CSRF 保护，并启用 CORS 保护。
  * 使用 ContentNegotiation 中间件以 JSON 格式发送 HTTP 响应。

API 起始套件配置了基于会话的身份验证。但是，如果您希望使用基于令牌的身份验证，您可以使用 `--auth-guard` 标志。

另请参阅：[我应该使用哪个身份验证守卫？](https://www.google.com/search?q=../authentication/introduction.md%23choosing-an-auth-guard)

```sh
npm init adonisjs@latest -- -K=api --auth-guard=access_tokens
```

-----

### Slim (精简) 起始套件 (Slim starter kit)

对于极简主义者，我们创建了一个 `slim` (精简) 起始套件。它仅包含框架核心和默认的文件夹结构。当您不想要 AdonisJS 的任何附加功能时，可以使用它。

```sh
npm init adonisjs@latest -- -K=slim

# 切换数据库方言
npm init adonisjs@latest -- -K=slim --db=mysql
```

-----

### Inertia 起始套件 (Inertia starter kit)

[Inertia](https://inertiajs.com/) 是一种构建服务器驱动的单页应用程序的方式。您可以使用自己喜欢的前端框架（React、Vue、Solid、Svelte）来构建应用程序的前端。

您可以使用 `--adapter` 标志来选择您想使用的前端框架。可用选项有 `react`、`vue`、`solid` 和 `svelte`。

您还可以使用 `--ssr` 和 `--no-ssr` 标志来开启或关闭服务器端渲染 (SSR)。

```sh
npm init adonisjs@latest -- -K=inertia

# 使用服务器端渲染的 React
npm init adonisjs@latest -- -K=inertia --adapter=react --ssr

# 不使用服务器端渲染的 Vue
npm init adonisjs@latest -- -K=inertia --adapter=vue --no-ssr
```

-----

### 引入您自己的起始套件 (Bring your starter kit)

起始套件是托管在 GitHub、Bitbucket 或 GitLab 等 Git 仓库提供商处的预构建项目。您也可以创建自己的起始套件，并按如下方式下载它们。

```sh
npm init adonisjs@latest -- -K="github_user/repo"

# 从 GitLab 下载
npm init adonisjs@latest -- -K="gitlab:user/repo"

# 从 Bitbucket 下载
npm init adonisjs@latest -- -K="bitbucket:user/repo"
```

您可以使用 `git` 模式通过 Git+SSH 身份验证下载私有仓库。

```sh
npm init adonisjs@latest -- -K="user/repo" --mode=git
```

最后，您可以指定一个标签、分支或提交。

```sh
# 分支
npm init adonisjs@latest -- -K="user/repo#develop"

# 标签
npm init adonisjs@latest -- -K="user/repo#v2.1.0"
```

## 启动开发服务器 (Starting the development server)

创建 AdonisJS 应用程序后，您可以通过运行 `node ace serve` 命令来启动开发服务器。

Ace 是一个捆绑在框架核心内部的命令行框架。`--hmr` 标志会监控文件系统，并对您代码库的某些部分执行[热模块替换 (HMR)](https://www.google.com/search?q=../concepts/hmr.md)。

```sh
node ace serve --hmr
```

开发服务器运行后，您可以访问 [http://localhost:3333](https://www.google.com/search?q=http://localhost:3333) 在浏览器中查看您的应用程序。

## 构建用于生产环境 (Building for production)

由于 AdonisJS 应用程序是用 TypeScript 编写的，因此在生产环境中运行之前，必须将其编译成 JavaScript。

您可以使用 `node ace build` 命令创建 JavaScript 输出。JavaScript 输出被写入 `build` 目录。

当配置了 Vite 时，此命令还会使用 Vite 编译前端资产，并将输出写入 `build/public` 文件夹。

另请参阅：[TypeScript 构建过程](https://www.google.com/search?q=../concepts/typescript_build_process.md)。

```sh
node ace build
```

## 配置开发环境 (Configuring the development environment)

虽然 AdonisJS 负责构建最终用户应用程序，但您可能需要额外的工具来享受开发过程并保持编码风格的一致性。

我们强烈建议您使用 **[ESLint](https://eslint.org/)** 来检查 (Lint) 您的代码，并使用 **[Prettier](https://prettier.io)** 来重新格式化您的代码以保持一致性。

官方起始套件预配置了 ESLint 和 Prettier，并使用了来自 AdonisJS 核心团队的规范预设。您可以在文档的[工具配置](https://www.google.com/search?q=../concepts/tooling_config.md)部分了解更多信息。

最后，我们建议您为您的代码编辑器安装 ESLint 和 Prettier 插件，以便在应用程序开发过程中拥有更紧密的反馈循环。此外，您可以使用以下命令从命令行对代码进行 `lint` 检查和 `format` 格式化。

```sh
# 运行 ESLint
npm run lint

# 运行 ESLint 并自动修复问题
npm run lint -- --fix

# 运行 prettier
npm run format
```

## VSCode 扩展 (VSCode extensions)

您可以在任何支持 TypeScript 的代码编辑器上开发 AdonisJS 应用程序。但是，我们为 VSCode 开发了多个扩展，以进一步增强开发体验。

  * [**AdonisJS**](https://marketplace.visualstudio.com/items?itemName=jripouteau.adonis-vscode-extension) - 直接从您的代码编辑器中查看应用程序路由、运行 ace 命令、迁移数据库和阅读文档。
  * [**Edge**](https://marketplace.visualstudio.com/items?itemName=AdonisJS.vscode-edge) - 通过支持语法高亮、自动补全和代码片段来增强您的开发工作流程。
  * [**Japa**](https://marketplace.visualstudio.com/items?itemName=jripouteau.japa-vscode) - 使用键盘快捷键或直接从活动侧边栏运行测试，无需离开您的代码编辑器。