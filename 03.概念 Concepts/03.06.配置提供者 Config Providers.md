# é…ç½®æä¾›è€… (Config providers)

ä¸€äº›é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `config/hash.ts`ï¼‰ä¸ä¼šå°†é…ç½®ä½œä¸ºæ™®é€šå¯¹è±¡ (plain object) å¯¼å‡ºã€‚ç›¸åï¼Œå®ƒä»¬å¯¼å‡ºä¸€ä¸ª[é…ç½®æä¾›è€… (config provider)](https://github.com/adonisjs/core/blob/main/src/config_provider.ts#L16)ã€‚é…ç½®æä¾›è€…ä¸ºè½¯ä»¶åŒ…æä¾›äº†ä¸€ä¸ªé€æ˜çš„ APIï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºå¼•å¯¼å**å»¶è¿Ÿè®¡ç®— (lazily compute)** é…ç½®ã€‚

## ä¸ä½¿ç”¨é…ç½®æä¾›è€… (Without config providers)

ä¸ºäº†ç†è§£é…ç½®æä¾›è€…ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœä¸ä½¿ç”¨é…ç½®æä¾›è€…ï¼Œ`config/hash.ts` æ–‡ä»¶ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚

```ts
import { Scrypt } from '@adonisjs/core/hash/drivers/scrypt'

export default {
  default: 'scrypt',
  list: {
    scrypt: () => new Scrypt({
      cost: 16384,
      blockSize: 8,
      parallelization: 1,
      maxMemory: 33554432,
    })
  }
}
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¥½ã€‚æˆ‘ä»¬æ²¡æœ‰ä» `drivers` é›†åˆä¸­å¼•ç”¨ `scrypt` é©±åŠ¨ç¨‹åºï¼Œè€Œæ˜¯ç›´æ¥å¯¼å…¥å®ƒå¹¶ä½¿ç”¨å·¥å‚å‡½æ•°è¿”å›ä¸€ä¸ªå®ä¾‹ã€‚

å‡è®¾ `Scrypt` é©±åŠ¨ç¨‹åºéœ€è¦ `Emitter` ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»¥ä¾¿æ¯æ¬¡å“ˆå¸Œå€¼æ—¶è§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚

```ts
import { Scrypt } from '@adonisjs/core/hash/drivers/scrypt'
// insert-start
import emitter from '@adonisjs/core/services/emitter'
// insert-end

export default {
  default: 'scrypt',
  list: {
    scrypt: () => new Scrypt({
      cost: 16384,
      blockSize: 8,
      parallelization: 1,
      maxMemory: 33554432,
    // insert-start
    }, emitter)
    // insert-end
  }
}
```

**ğŸš¨ ä¸Šé¢çš„ä¾‹å­ä¼šå¤±è´¥**ï¼Œå› ä¸º AdonisJS [å®¹å™¨æœåŠ¡](https://www.google.com/search?q=./container_services.md)ç›´åˆ°åº”ç”¨ç¨‹åºå¼•å¯¼åæ‰å¯ç”¨ï¼Œè€Œé…ç½®æ–‡ä»¶æ˜¯åœ¨åº”ç”¨ç¨‹åºå¼•å¯¼é˜¶æ®µä¹‹å‰å¯¼å…¥çš„ã€‚

### é‚£ä¹ˆï¼Œè¿™æ˜¯ AdonisJS æ¶æ„çš„é—®é¢˜å–½ï¼Ÿ ğŸ¤·ğŸ»â€â™‚ï¸

å¹¶ä¸å°½ç„¶ã€‚è®©æˆ‘ä»¬ä¸ä½¿ç”¨å®¹å™¨æœåŠ¡ï¼Œè€Œæ˜¯ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ›å»º `Emitter` ç±»çš„å®ä¾‹ã€‚

```ts
import { Scrypt } from '@adonisjs/core/hash/drivers/scrypt'
// delete-start
import emitter from '@adonisjs/core/services/emitter'
// delete-end
// insert-start
import { Emitter } from '@adonisjs/core/events'
// insert-end

// insert-start
const emitter = new Emitter()
// insert-end

export default {
  default: 'scrypt',
  list: {
    scrypt: () => new Scrypt({
      cost: 16384,
      blockSize: 8,
      parallelization: 1,
      maxMemory: 33554432,
    }, emitter)
  }
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ–°é—®é¢˜ã€‚æˆ‘ä»¬åœ¨ `Scrypt` é©±åŠ¨ç¨‹åºä¸­åˆ›å»ºçš„ `emitter` å®ä¾‹ä¸æ˜¯å…¨å±€å¯ç”¨çš„ï¼Œæˆ‘ä»¬æ— æ³•å¯¼å…¥å®ƒå¹¶ç›‘å¬é©±åŠ¨ç¨‹åºè§¦å‘çš„äº‹ä»¶ã€‚

å› æ­¤ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°† `Emitter` ç±»çš„æ„å»ºç§»è‡³å…¶è‡ªå·±çš„æ–‡ä»¶ä¸­å¹¶å¯¼å‡ºä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥å°†**äº‹ä»¶è§¦å‘å™¨ (emitter)** å®ä¾‹ä¼ é€’ç»™é©±åŠ¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ç›‘å¬äº‹ä»¶ã€‚

```ts
// title: start/emitter.ts
import { Emitter } from '@adonisjs/core/events'
export const emitter = new Emitter()
```

```ts
import { Scrypt } from '@adonisjs/core/hash/drivers/scrypt'
// delete-start
import { Emitter } from '@adonisjs/core/events'
// delete-end
// insert-start
import { emitter } from '#start/emitter'
// insert-end

// delete-start
const emitter = new Emitter()
// delete-end

export default {
  default: 'scrypt',
  list: {
    scrypt: () => new Scrypt({
      cost: 16384,
      blockSize: 8,
      parallelization: 1,
      maxMemory: 33554432,
    }, emitter)
  }
}
```

ä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä½†æ˜¯ï¼Œè¿™æ¬¡æ‚¨æ˜¯åœ¨æ‰‹åŠ¨æ„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¾èµ–é¡¹ã€‚ç»“æœæ˜¯ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°†æœ‰å¤§é‡çš„æ ·æ¿ä»£ç æ¥å°†æ‰€æœ‰å†…å®¹è¿æ¥åœ¨ä¸€èµ·ã€‚

ä½¿ç”¨ AdonisJSï¼Œæˆ‘ä»¬è‡´åŠ›äºç¼–å†™æœ€å°‘çš„æ ·æ¿ä»£ç ï¼Œå¹¶ä½¿ç”¨ IoC å®¹å™¨æ¥æŸ¥æ‰¾ä¾èµ–é¡¹ã€‚

## ä½¿ç”¨é…ç½®æä¾›è€… (With config provider)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é‡å†™ `config/hash.ts` æ–‡ä»¶ï¼Œè¿™æ¬¡ä½¿ç”¨é…ç½®æä¾›è€…ã€‚é…ç½®æä¾›è€…æ˜¯ä¸€ä¸ªæ¯”è¾ƒâ€œèŠ±å“¨â€çš„å«æ³•ï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯ä¸€ä¸ªæ¥å— [Application ç±»å®ä¾‹](https://www.google.com/search?q=./application.md) å¹¶ä½¿ç”¨å®¹å™¨è§£æå…¶ä¾èµ–é¡¹çš„å‡½æ•°ã€‚

```ts
// highlight-start
import { configProvider } from '@adonisjs/core'
// highlight-end
import { Scrypt } from '@adonisjs/core/hash/drivers/scrypt'

export default {
  default: 'scrypt',
  list: {
    // highlight-start
    scrypt: configProvider.create(async (app) => {
      const emitter = await app.container.make('emitter')

      return () => new Scrypt({
        cost: 16384,
        blockSize: 8,
        parallelization: 1,
        maxMemory: 33554432,
      }, emitter)
    })
    // highlight-end
  }
}
```

ä¸€æ—¦æ‚¨ä½¿ç”¨ [hash](https://www.google.com/search?q=../security/hashing.md) æœåŠ¡ï¼Œ`scrypt` é©±åŠ¨ç¨‹åºçš„é…ç½®æä¾›è€…å°±ä¼šè¢«æ‰§è¡Œä»¥è§£æå…¶ä¾èµ–é¡¹ã€‚ç»“æœæ˜¯ï¼Œç›´åˆ°æˆ‘ä»¬åœ¨ä»£ç ä¸­çš„å…¶ä»–åœ°æ–¹ä½¿ç”¨ hash æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šå°è¯•æŸ¥æ‰¾ `emitter`ã€‚

ç”±äºé…ç½®æä¾›è€…æ˜¯å¼‚æ­¥çš„ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é€šè¿‡åŠ¨æ€å¯¼å…¥æ¥å»¶è¿Ÿå¯¼å…¥ `Scrypt` é©±åŠ¨ç¨‹åºã€‚

```ts
import { configProvider } from '@adonisjs/core'
// delete-start
import { Scrypt } from '@adonisjs/core/hash/drivers/scrypt'
// delete-end

export default {
  default: 'scrypt',
  list: {
    scrypt: configProvider.create(async (app) => {
      // insert-start
      const { Scrypt } = await import('@adonisjs/core/hash/drivers/scrypt')
      // insert-end
      const emitter = await app.container.make('emitter')

      return () => new Scrypt({
        cost: 16384,
        blockSize: 8,
        parallelization: 1,
        maxMemory: 33554432,
      }, emitter)
    })
  }
}
```

## å¦‚ä½•è®¿é—®è§£æåçš„é…ç½®ï¼Ÿ (How do I access the resolved config?)

æ‚¨å¯ä»¥ç›´æ¥ä»æœåŠ¡ä¸­è®¿é—®è§£æåçš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ hash æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è·å–å¯¹è§£æåé…ç½®çš„å¼•ç”¨ã€‚

```ts
import hash from '@adonisjs/core/services/hash'
console.log(hash.config)
```